---


title: Location
description: Location model reference


---
# Model: Location

The Location model represents physical or virtual locations where inventory is stored and orders can be fulfilled from (warehouses, stores, fulfillment centers, dropship suppliers).

[TOC]

## Overview

A **Location** is any place that holds inventory:

```php
Location {
    name: "Warehouse NYC"
    code: "NYC-01"
    type: "warehouse"
    address: "123 Main St, New York, NY 10001"
    is_active: true
    is_fulfillment_center: true
    priority: 10
}
```

**Location Types**:
- **Warehouse** - Central distribution
- **Store** - Retail location
- **Fulfillment Center** - 3PL partner
- **Dropship** - Supplier direct ship
- **Virtual** - Digital products

---

## Database Schema

```php
Schema::create('locations', function (Blueprint $table) {
    $table->id();

    // Basic info
    $table->string('name');
    $table->string('code')->unique(); // NYC-01, LA-STORE
    $table->string('type')->default('warehouse'); // warehouse, store, fulfillment_center, dropship, virtual
    $table->text('description')->nullable();

    // Address
    $table->string('address_line_1')->nullable();
    $table->string('address_line_2')->nullable();
    $table->string('city')->nullable();
    $table->string('state')->nullable();
    $table->string('postal_code')->nullable();
    $table->string('country', 2)->nullable();

    // Contact
    $table->string('phone')->nullable();
    $table->string('email')->nullable();

    // Geo coordinates
    $table->decimal('latitude', 10, 8)->nullable();
    $table->decimal('longitude', 11, 8)->nullable();

    // Settings
    $table->boolean('is_active')->default(true);
    $table->boolean('is_fulfillment_center')->default(true);
    $table->boolean('is_pickup_location')->default(false);
    $table->integer('priority')->default(0); // Higher = prefer this location

    // Capacity
    $table->integer('max_capacity')->nullable();

    // Operating hours
    $table->json('operating_hours')->nullable();
    /*
    {
        "monday": {"open": "09:00", "close": "18:00"},
        "tuesday": {"open": "09:00", "close": "18:00"},
        ...
    }
    */

    // Shipping zones
    $table->json('shipping_zones')->nullable(); // Array of zone IDs

    // Meta
    $table->json('data')->nullable();

    $table->timestamps();
    $table->softDeletes();

    // Indexes
    $table->index('code');
    $table->index('type');
    $table->index('is_active');
    $table->index('is_fulfillment_center');
    $table->index('priority');
});
```

---

## Properties

| Property | Type | Description |
|----------|------|-------------|
| `id` | `bigint` | Primary key |
| `name` | `string` | Location name |
| `code` | `string` | Location code (unique) |
| `type` | `string` | Location type |
| `description` | `text` | Description |
| `address_line_1` | `string` | Address line 1 |
| `address_line_2` | `string` | Address line 2 |
| `city` | `string` | City |
| `state` | `string` | State/Province |
| `postal_code` | `string` | Postal code |
| `country` | `string` | ISO country code |
| `phone` | `string` | Phone number |
| `email` | `string` | Email |
| `latitude` | `decimal` | Latitude |
| `longitude` | `decimal` | Longitude |
| `is_active` | `boolean` | Active status |
| `is_fulfillment_center` | `boolean` | Can fulfill orders |
| `is_pickup_location` | `boolean` | Allows customer pickup |
| `priority` | `integer` | Priority order |
| `max_capacity` | `integer` | Maximum capacity |
| `operating_hours` | `json` | Operating hours |
| `shipping_zones` | `json` | Shipping zones |
| `data` | `json` | Custom data |

---

## Relationships

```php
namespace Shopper\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Database\Eloquent\SoftDeletes;

class Location extends Model
{
    use SoftDeletes;

    protected $fillable = [
        'name',
        'code',
        'type',
        'description',
        'address_line_1',
        'address_line_2',
        'city',
        'state',
        'postal_code',
        'country',
        'phone',
        'email',
        'latitude',
        'longitude',
        'is_active',
        'is_fulfillment_center',
        'is_pickup_location',
        'priority',
        'max_capacity',
        'operating_hours',
        'shipping_zones',
        'data',
    ];

    protected $casts = [
        'latitude' => 'decimal:8',
        'longitude' => 'decimal:8',
        'is_active' => 'boolean',
        'is_fulfillment_center' => 'boolean',
        'is_pickup_location' => 'boolean',
        'priority' => 'integer',
        'max_capacity' => 'integer',
        'operating_hours' => 'array',
        'shipping_zones' => 'array',
        'data' => 'array',
    ];

    // Inventory levels
    public function inventoryLevels(): HasMany
    {
        return $this->hasMany(InventoryLevel::class);
    }

    // Stock movements
    public function stockMovements(): HasMany
    {
        return $this->hasMany(StockMovement::class);
    }

    // Orders fulfilled from this location
    public function orders(): HasMany
    {
        return $this->hasMany(Order::class, 'fulfillment_location_id');
    }
}
```

---

## Scopes

```php
// Active locations
public function scopeActive($query)
{
    return $query->where('is_active', true);
}

// Fulfillment centers
public function scopeFulfillmentCenters($query)
{
    return $query->where('is_fulfillment_center', true);
}

// Pickup locations
public function scopePickupLocations($query)
{
    return $query->where('is_pickup_location', true);
}

// By type
public function scopeOfType($query, string $type)
{
    return $query->where('type', $type);
}

// By priority
public function scopeByPriority($query)
{
    return $query->orderByDesc('priority');
}

// Near coordinates
public function scopeNear($query, float $latitude, float $longitude, int $radiusKm = 50)
{
    return $query->selectRaw('*, ( 6371 * acos( cos( radians(?) ) * cos( radians( latitude ) ) * cos( radians( longitude ) - radians(?) ) + sin( radians(?) ) * sin( radians( latitude ) ) ) ) AS distance', [$latitude, $longitude, $latitude])
        ->having('distance', '<', $radiusKm)
        ->orderBy('distance');
}
```

---

## Accessors & Mutators

```php
// Full address
public function getFullAddressAttribute(): string
{
    $parts = array_filter([
        $this->address_line_1,
        $this->address_line_2,
        $this->city,
        $this->state,
        $this->postal_code,
        $this->country,
    ]);

    return implode(', ', $parts);
}

// Total inventory value
public function getTotalInventoryValueAttribute(): float
{
    return $this->inventoryLevels()
        ->join('inventory_items', 'inventory_levels.inventory_item_id', '=', 'inventory_items.id')
        ->sum(DB::raw('inventory_levels.quantity * inventory_items.unit_cost'));
}

// Current capacity usage
public function getCurrentCapacityAttribute(): int
{
    return $this->inventoryLevels()->sum('quantity');
}

// Available capacity
public function getAvailableCapacityAttribute(): ?int
{
    if (!$this->max_capacity) {
        return null;
    }

    return max(0, $this->max_capacity - $this->current_capacity);
}

// Is at capacity
public function getIsAtCapacityAttribute(): bool
{
    if (!$this->max_capacity) {
        return false;
    }

    return $this->current_capacity >= $this->max_capacity;
}

// Is open now
public function getIsOpenNowAttribute(): bool
{
    if (!$this->operating_hours) {
        return true;
    }

    $today = strtolower(now()->englishDayOfWeek);
    $hours = $this->operating_hours[$today] ?? null;

    if (!$hours) {
        return false;
    }

    $now = now()->format('H:i');
    return $now >= $hours['open'] && $now <= $hours['close'];
}
```

---

## Methods

### Get Stock for SKU

```php
public function getStockFor(string $sku): ?InventoryLevel
{
    return $this->inventoryLevels()
        ->whereHas('inventoryItem', fn($q) => $q->where('sku', $sku))
        ->first();
}
```

### Check if Can Fulfill

```php
public function canFulfill(array $items): bool
{
    if (!$this->is_active || !$this->is_fulfillment_center) {
        return false;
    }

    foreach ($items as $item) {
        $level = $this->inventoryLevels()
            ->where('inventory_item_id', $item['inventory_item_id'])
            ->first();

        if (!$level || $level->available_quantity < $item['quantity']) {
            return false;
        }
    }

    return true;
}
```

### Calculate Distance To

```php
public function calculateDistanceTo(float $latitude, float $longitude): ?float
{
    if (!$this->latitude || !$this->longitude) {
        return null;
    }

    $earthRadius = 6371; // km

    $latFrom = deg2rad($this->latitude);
    $lonFrom = deg2rad($this->longitude);
    $latTo = deg2rad($latitude);
    $lonTo = deg2rad($longitude);

    $latDelta = $latTo - $latFrom;
    $lonDelta = $lonTo - $lonFrom;

    $angle = 2 * asin(sqrt(pow(sin($latDelta / 2), 2) +
        cos($latFrom) * cos($latTo) * pow(sin($lonDelta / 2), 2)));

    return $angle * $earthRadius;
}
```

### Get Low Stock Items

```php
public function getLowStockItems(): Collection
{
    return $this->inventoryLevels()
        ->with('inventoryItem.variant.product')
        ->lowStock()
        ->get();
}
```

---

## REST API

### List Locations

```http
GET /api/v1/locations
```

**Query Parameters**:
- `type` - Filter by type
- `is_active` - Filter by active status
- `near[lat]` & `near[lng]` - Find nearby locations

**Response**:
```json
{
  "data": [
    {
      "id": 5,
      "name": "Warehouse NYC",
      "code": "NYC-01",
      "type": "warehouse",
      "full_address": "123 Main St, New York, NY 10001",
      "is_active": true,
      "is_fulfillment_center": true,
      "priority": 10,
      "current_capacity": 5420,
      "available_capacity": 4580
    }
  ]
}
```

### Get Location Stock

```http
GET /api/v1/locations/{id}/stock
```

**Response**:
```json
{
  "location": {
    "id": 5,
    "name": "Warehouse NYC"
  },
  "items": [
    {
      "sku": "TSH-BLU-L",
      "product": "T-Shirt - Blue / Large",
      "quantity": 50,
      "available": 35,
      "reserved": 15
    }
  ]
}
```

---

## GraphQL API

```graphql
query {
  locations(isActive: true) {
    id
    name
    code
    type
    fullAddress
    isOpenNow
    currentCapacity
    availableCapacity
  }
}

query {
  location(id: 5) {
    name
    inventoryLevels {
      inventoryItem {
        sku
      }
      quantity
      availableQuantity
    }
  }
}
```

---

## Practical Examples

### Find Nearest Location

```php
use Shopper\Models\Location;

$customerLat = 40.7128;
$customerLng = -74.0060;

$nearest = Location::active()
    ->fulfillmentCenters()
    ->near($customerLat, $customerLng, 100)
    ->first();

$distance = $nearest->calculateDistanceTo($customerLat, $customerLng);
```

### Smart Order Routing

```php
$orderItems = [
    ['inventory_item_id' => 1, 'quantity' => 2],
    ['inventory_item_id' => 2, 'quantity' => 5],
];

$locations = Location::active()
    ->fulfillmentCenters()
    ->byPriority()
    ->get();

foreach ($locations as $location) {
    if ($location->canFulfill($orderItems)) {
        // Assign order to this location
        $order->update(['fulfillment_location_id' => $location->id]);
        break;
    }
}
```

---

## Related Documentation

- [InventoryLevel Model](model-inventory-level)
- [InventoryItem Model](model-inventory-item)
- [StockMovement Model](model-stock-movement)
- [Inventory Management Guide](inventory-management)
- [REST API - Inventory](api-inventory)
