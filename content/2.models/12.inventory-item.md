---


title: InventoryItem
description: InventoryItem model reference


---
# Model: InventoryItem

The InventoryItem model represents a trackable item in the inventory system. Each ProductVariant that requires inventory tracking has one InventoryItem that tracks stock across multiple locations.

[TOC]

## Overview

An **InventoryItem** is the central entity for inventory tracking:

```php
InventoryItem {
    product_variant_id: 245
    sku: "TSH-BLU-L"
    tracked: true
    requires_shipping: true
    unit_cost: 25.00
    total_quantity: 150
    available_quantity: 120
    reserved_quantity: 30
}
```

**Inventory Architecture**:
- **InventoryItem**: One per variant (tracks globally)
- **InventoryLevel**: Stock at specific locations
- **StockMovement**: Historical tracking of changes

---

## Database Schema

```php
Schema::create('inventory_items', function (Blueprint $table) {
    $table->id();

    // Variant (one-to-one)
    $table->foreignId('product_variant_id')->unique()->constrained()->cascadeOnDelete();

    // Identifiers
    $table->string('sku')->index();
    $table->string('barcode')->nullable()->index();

    // Tracking settings
    $table->boolean('tracked')->default(true);
    $table->boolean('requires_shipping')->default(true);
    $table->boolean('allow_backorder')->default(false);
    $table->boolean('continue_selling_when_out_of_stock')->default(false);

    // Cost
    $table->decimal('unit_cost', 15, 2)->nullable();

    // Aggregated quantities (cached from inventory_levels)
    $table->integer('total_quantity')->default(0);
    $table->integer('available_quantity')->default(0);
    $table->integer('reserved_quantity')->default(0);
    $table->integer('committed_quantity')->default(0); // In carts
    $table->integer('incoming_quantity')->default(0); // Purchase orders

    // Reorder settings
    $table->integer('reorder_point')->nullable();
    $table->integer('reorder_quantity')->nullable();

    // Weight & dimensions
    $table->decimal('weight', 10, 2)->nullable();
    $table->string('weight_unit')->default('g');
    $table->decimal('length', 10, 2)->nullable();
    $table->decimal('width', 10, 2)->nullable();
    $table->decimal('height', 10, 2)->nullable();
    $table->string('dimensions_unit')->default('cm');

    // Country of origin
    $table->string('country_of_origin', 2)->nullable();
    $table->string('hs_code')->nullable(); // Harmonized System code

    $table->timestamps();

    // Indexes
    $table->index('sku');
    $table->index('barcode');
    $table->index('tracked');
    $table->index('available_quantity');
});
```

---

## Properties

| Property | Type | Description |
|----------|------|-------------|
| `id` | `bigint` | Primary key |
| `product_variant_id` | `bigint` | ProductVariant ID (FK, unique) |
| `sku` | `string` | SKU |
| `barcode` | `string` | Barcode |
| `tracked` | `boolean` | Enable inventory tracking |
| `requires_shipping` | `boolean` | Physical product |
| `allow_backorder` | `boolean` | Allow negative stock |
| `continue_selling_when_out_of_stock` | `boolean` | Sell when 0 stock |
| `unit_cost` | `decimal` | Cost per unit |
| `total_quantity` | `integer` | Total stock |
| `available_quantity` | `integer` | Available for sale |
| `reserved_quantity` | `integer` | Reserved for orders |
| `committed_quantity` | `integer` | In carts |
| `incoming_quantity` | `integer` | Expected stock |
| `reorder_point` | `integer` | Reorder threshold |
| `reorder_quantity` | `integer` | Reorder amount |
| `weight` | `decimal` | Weight |
| `weight_unit` | `string` | g, kg, lb, oz |
| `length/width/height` | `decimal` | Dimensions |
| `dimensions_unit` | `string` | cm, m, in, ft |
| `country_of_origin` | `string` | ISO country code |
| `hs_code` | `string` | Customs code |

---

## Relationships

```php
namespace Cartino\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class InventoryItem extends Model
{
    protected $fillable = [
        'product_variant_id',
        'sku',
        'barcode',
        'tracked',
        'requires_shipping',
        'allow_backorder',
        'continue_selling_when_out_of_stock',
        'unit_cost',
        'total_quantity',
        'available_quantity',
        'reserved_quantity',
        'committed_quantity',
        'incoming_quantity',
        'reorder_point',
        'reorder_quantity',
        'weight',
        'weight_unit',
        'length',
        'width',
        'height',
        'dimensions_unit',
        'country_of_origin',
        'hs_code',
    ];

    protected $casts = [
        'tracked' => 'boolean',
        'requires_shipping' => 'boolean',
        'allow_backorder' => 'boolean',
        'continue_selling_when_out_of_stock' => 'boolean',
        'unit_cost' => 'decimal:2',
        'total_quantity' => 'integer',
        'available_quantity' => 'integer',
        'reserved_quantity' => 'integer',
        'committed_quantity' => 'integer',
        'incoming_quantity' => 'integer',
        'reorder_point' => 'integer',
        'reorder_quantity' => 'integer',
        'weight' => 'decimal:2',
        'length' => 'decimal:2',
        'width' => 'decimal:2',
        'height' => 'decimal:2',
    ];

    // Variant
    public function variant(): BelongsTo
    {
        return $this->belongsTo(ProductVariant::class, 'product_variant_id');
    }

    // Inventory levels (per location)
    public function levels(): HasMany
    {
        return $this->hasMany(InventoryLevel::class);
    }

    // Stock movements
    public function movements(): HasMany
    {
        return $this->hasMany(StockMovement::class);
    }
}
```

---

## Scopes

```php
// Tracked items
public function scopeTracked($query)
{
    return $query->where('tracked', true);
}

// Low stock
public function scopeLowStock($query)
{
    return $query->where('tracked', true)
        ->whereColumn('available_quantity', '<=', 'reorder_point');
}

// Out of stock
public function scopeOutOfStock($query)
{
    return $query->where('tracked', true)
        ->where('available_quantity', '<=', 0);
}

// Available
public function scopeAvailable($query, int $quantity = 1)
{
    return $query->where(function ($q) use ($quantity) {
        $q->where('tracked', false)
          ->orWhere('available_quantity', '>=', $quantity)
          ->orWhere('allow_backorder', true)
          ->orWhere('continue_selling_when_out_of_stock', true);
    });
}
```

---

## Accessors & Mutators

```php
// Is available
public function getIsAvailableAttribute(): bool
{
    if (!$this->tracked) {
        return true;
    }

    if ($this->available_quantity > 0) {
        return true;
    }

    return $this->allow_backorder || $this->continue_selling_when_out_of_stock;
}

// Is low stock
public function getIsLowStockAttribute(): bool
{
    if (!$this->tracked || !$this->reorder_point) {
        return false;
    }

    return $this->available_quantity <= $this->reorder_point;
}

// Is out of stock
public function getIsOutOfStockAttribute(): bool
{
    return $this->tracked && $this->available_quantity <= 0;
}

// Needs reorder
public function getNeedsReorderAttribute(): bool
{
    return $this->is_low_stock || $this->is_out_of_stock;
}

// Volume
public function getVolumeAttribute(): ?float
{
    if (!$this->length || !$this->width || !$this->height) {
        return null;
    }

    return $this->length * $this->width * $this->height;
}
```

---

## Methods

### Check Availability

```php
public function isAvailable(int $quantity = 1): bool
{
    if (!$this->tracked) {
        return true;
    }

    if ($this->available_quantity >= $quantity) {
        return true;
    }

    return $this->allow_backorder || $this->continue_selling_when_out_of_stock;
}
```

### Reserve Stock

```php
public function reserve(int $quantity, string $reason = null): void
{
    if (!$this->tracked) {
        return;
    }

    if (!$this->isAvailable($quantity)) {
        throw new InsufficientStockException(
            "Only {$this->available_quantity} units available"
        );
    }

    $this->decrement('available_quantity', $quantity);
    $this->increment('reserved_quantity', $quantity);

    // Record movement
    $this->movements()->create([
        'type' => 'reservation',
        'quantity' => -$quantity,
        'reason' => $reason ?? 'Order reservation',
    ]);
}
```

### Release Stock

```php
public function release(int $quantity, string $reason = null): void
{
    if (!$this->tracked) {
        return;
    }

    $releaseQty = min($quantity, $this->reserved_quantity);

    $this->increment('available_quantity', $releaseQty);
    $this->decrement('reserved_quantity', $releaseQty);

    // Record movement
    $this->movements()->create([
        'type' => 'release',
        'quantity' => $releaseQty,
        'reason' => $reason ?? 'Reservation cancelled',
    ]);
}
```

### Adjust Stock

```php
public function adjust(int $quantity, string $reason, ?Location $location = null): void
{
    if (!$this->tracked) {
        return;
    }

    // Update total quantities
    if ($quantity > 0) {
        $this->increment('available_quantity', $quantity);
        $this->increment('total_quantity', $quantity);
    } else {
        $this->decrement('available_quantity', abs($quantity));
        $this->decrement('total_quantity', abs($quantity));
    }

    // Update location level if specified
    if ($location) {
        $level = $this->levels()->where('location_id', $location->id)->first();
        if ($level) {
            $level->adjust($quantity, $reason);
        }
    }

    // Record movement
    $this->movements()->create([
        'type' => $quantity > 0 ? 'adjustment_in' : 'adjustment_out',
        'quantity' => $quantity,
        'location_id' => $location?->id,
        'reason' => $reason,
    ]);
}
```

### Recalculate Quantities

```php
public function recalculate(): void
{
    $levels = $this->levels;

    $this->total_quantity = $levels->sum('quantity');
    $this->available_quantity = $levels->sum('available_quantity');
    $this->reserved_quantity = $levels->sum('reserved_quantity');

    $this->save();
}
```

---

## Events

```php
use Cartino\Events\InventoryLowStock;
use Cartino\Events\InventoryOutOfStock;

protected static function booted()
{
    static::updated(function (InventoryItem $item) {
        // Check for low stock
        if ($item->isDirty('available_quantity')) {
            if ($item->is_low_stock && !$item->is_out_of_stock) {
                event(new InventoryLowStock($item));
            }

            if ($item->is_out_of_stock) {
                event(new InventoryOutOfStock($item));
            }
        }
    });
}
```

---

## REST API

### Get Inventory Item

```http
GET /api/v1/inventory-items/{id}
```

**Response**:
```json
{
  "id": 1,
  "sku": "TSH-BLU-L",
  "tracked": true,
  "total_quantity": 150,
  "available_quantity": 120,
  "reserved_quantity": 30,
  "is_available": true,
  "is_low_stock": false,
  "is_out_of_stock": false,
  "variant": {
    "id": 245,
    "display_name": "T-Shirt - Blue / Large"
  }
}
```

### Adjust Stock

```http
POST /api/v1/inventory-items/{id}/adjust
```

**Request**:
```json
{
  "quantity": 50,
  "reason": "Received from supplier",
  "location_id": 1
}
```

### Check Availability

```http
POST /api/v1/inventory-items/{id}/check-availability
```

**Request**:
```json
{
  "quantity": 10
}
```

**Response**:
```json
{
  "available": true,
  "available_quantity": 120,
  "requested_quantity": 10
}
```

---

## GraphQL API

```graphql
query {
  inventoryItem(id: 1) {
    id
    sku
    tracked
    totalQuantity
    availableQuantity
    reservedQuantity
    isAvailable
    isLowStock
    isOutOfStock
    levels {
      location {
        name
      }
      quantity
      availableQuantity
    }
  }
}

mutation {
  adjustInventory(
    id: 1
    quantity: 50
    reason: "Received from supplier"
    locationId: 1
  ) {
    inventoryItem {
      availableQuantity
      totalQuantity
    }
  }
}
```
