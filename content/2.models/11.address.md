---


title: Address
description: Address model reference


---

# Model: Address

The Address model stores customer addresses for shipping, billing, and company locations. It supports international addresses with full validation and geocoding capabilities.

[TOC]

## Overview

An **Address** represents a physical location:

```php
Address {
    customer_id: 123
    type: "shipping"
    first_name: "John"
    last_name: "Doe"
    company: "Acme Corp"
    address_line_1: "123 Main Street"
    city: "New York"
    state: "NY"
    postal_code: "10001"
    country: "US"
    is_default: true
}
```

**Address Types**:

- **Shipping** - Delivery address
- **Billing** - Invoice address
- **Company** - Business address

---

## Database Schema

```php
Schema::create('addresses', function (Blueprint $table) {
    $table->id();

    // Owner (polymorphic)
    $table->morphs('addressable'); // customer_id, order_id, etc.

    // Type
    $table->string('type')->default('shipping'); // shipping, billing, company

    // Contact
    $table->string('first_name')->nullable();
    $table->string('last_name')->nullable();
    $table->string('company')->nullable();
    $table->string('phone')->nullable();

    // Address
    $table->string('address_line_1');
    $table->string('address_line_2')->nullable();
    $table->string('city');
    $table->string('state')->nullable();
    $table->string('postal_code');
    $table->string('country', 2); // ISO 3166-1 alpha-2

    // Geocoding
    $table->decimal('latitude', 10, 8)->nullable();
    $table->decimal('longitude', 11, 8)->nullable();

    // Tax/VAT
    $table->string('tax_id')->nullable(); // VAT number, Tax ID

    // Flags
    $table->boolean('is_default')->default(false);
    $table->boolean('is_verified')->default(false);

    // Meta
    $table->json('data')->nullable();
    $table->text('notes')->nullable();

    $table->timestamps();

    // Indexes
    $table->index(['addressable_type', 'addressable_id']);
    $table->index('type');
    $table->index('country');
    $table->index('postal_code');
    $table->index('is_default');
});
```

---

## Properties

| Property           | Type      | Description      |
| ------------------ | --------- | ---------------- |
| `id`               | `bigint`  | Primary key      |
| `addressable_type` | `string`  | Owner model type |
| `addressable_id`   | `bigint`  | Owner model ID   |
| `type`             | `string`  | Address type     |
| `first_name`       | `string`  | First name       |
| `last_name`        | `string`  | Last name        |
| `company`          | `string`  | Company name     |
| `phone`            | `string`  | Phone number     |
| `address_line_1`   | `string`  | Address line 1   |
| `address_line_2`   | `string`  | Address line 2   |
| `city`             | `string`  | City             |
| `state`            | `string`  | State/Province   |
| `postal_code`      | `string`  | Postal code      |
| `country`          | `string`  | ISO country code |
| `latitude`         | `decimal` | Latitude         |
| `longitude`        | `decimal` | Longitude        |
| `tax_id`           | `string`  | Tax/VAT ID       |
| `is_default`       | `boolean` | Default address  |
| `is_verified`      | `boolean` | Verified status  |
| `data`             | `json`    | Custom data      |
| `notes`            | `text`    | Notes            |

---

## Relationships

```php
namespace Cartino\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\MorphTo;

class Address extends Model
{
    protected $fillable = [
        'addressable_type',
        'addressable_id',
        'type',
        'first_name',
        'last_name',
        'company',
        'phone',
        'address_line_1',
        'address_line_2',
        'city',
        'state',
        'postal_code',
        'country',
        'latitude',
        'longitude',
        'tax_id',
        'is_default',
        'is_verified',
        'data',
        'notes',
    ];

    protected $casts = [
        'latitude' => 'decimal:8',
        'longitude' => 'decimal:8',
        'is_default' => 'boolean',
        'is_verified' => 'boolean',
        'data' => 'array',
    ];

    // Owner (Customer, Order, etc.)
    public function addressable(): MorphTo
    {
        return $this->morphTo();
    }
}
```

---

## Scopes

```php
// By type
public function scopeOfType($query, string $type)
{
    return $query->where('type', $type);
}

// Shipping addresses
public function scopeShipping($query)
{
    return $query->where('type', 'shipping');
}

// Billing addresses
public function scopeBilling($query)
{
    return $query->where('type', 'billing');
}

// Default address
public function scopeDefault($query)
{
    return $query->where('is_default', true);
}

// By country
public function scopeInCountry($query, string $countryCode)
{
    return $query->where('country', $countryCode);
}

// Verified addresses
public function scopeVerified($query)
{
    return $query->where('is_verified', true);
}
```

---

## Accessors & Mutators

```php
// Full name
public function getFullNameAttribute(): string
{
    return trim("{$this->first_name} {$this->last_name}");
}

// Full address
public function getFullAddressAttribute(): string
{
    $parts = array_filter([
        $this->address_line_1,
        $this->address_line_2,
        $this->city,
        $this->state,
        $this->postal_code,
    ]);

    return implode(', ', $parts);
}

// Formatted address
public function getFormattedAttribute(): string
{
    $lines = [];

    if ($this->full_name) {
        $lines[] = $this->full_name;
    }

    if ($this->company) {
        $lines[] = $this->company;
    }

    $lines[] = $this->address_line_1;

    if ($this->address_line_2) {
        $lines[] = $this->address_line_2;
    }

    $cityLine = $this->city;
    if ($this->state) {
        $cityLine .= ", {$this->state}";
    }
    $cityLine .= " {$this->postal_code}";
    $lines[] = $cityLine;

    $lines[] = Countries::getName($this->country);

    return implode("\n", $lines);
}

// Country name
public function getCountryNameAttribute(): string
{
    return Countries::getName($this->country) ?? $this->country;
}

// Has coordinates
public function getHasCoordinatesAttribute(): bool
{
    return $this->latitude !== null && $this->longitude !== null;
}
```

---

## Methods

### Set as Default

```php
public function setAsDefault(): void
{
    // Remove default from other addresses of same type
    self::where('addressable_type', $this->addressable_type)
        ->where('addressable_id', $this->addressable_id)
        ->where('type', $this->type)
        ->where('id', '!=', $this->id)
        ->update(['is_default' => false]);

    $this->update(['is_default' => true]);
}
```

### Geocode Address

```php
public function geocode(): void
{
    $geocoder = app(GeocoderInterface::class);

    try {
        $result = $geocoder->geocode($this->full_address)->first();

        if ($result) {
            $this->update([
                'latitude' => $result->getCoordinates()->getLatitude(),
                'longitude' => $result->getCoordinates()->getLongitude(),
                'is_verified' => true,
            ]);
        }
    } catch (\Exception $e) {
        logger()->error('Geocoding failed', [
            'address_id' => $this->id,
            'error' => $e->getMessage(),
        ]);
    }
}
```

### Validate Address

```php
public function validate(): array
{
    $errors = [];

    // Required fields
    if (!$this->address_line_1) {
        $errors['address_line_1'] = 'Address is required';
    }

    if (!$this->city) {
        $errors['city'] = 'City is required';
    }

    if (!$this->postal_code) {
        $errors['postal_code'] = 'Postal code is required';
    }

    if (!$this->country) {
        $errors['country'] = 'Country is required';
    }

    // Validate postal code format by country
    if ($this->country && $this->postal_code) {
        $valid = match($this->country) {
            'US' => preg_match('/^\d{5}(-\d{4})?$/', $this->postal_code),
            'GB' => preg_match('/^[A-Z]{1,2}\d{1,2}[A-Z]?\s?\d[A-Z]{2}$/i', $this->postal_code),
            'IT' => preg_match('/^\d{5}$/', $this->postal_code),
            default => true,
        };

        if (!$valid) {
            $errors['postal_code'] = 'Invalid postal code format';
        }
    }

    return [
        'valid' => empty($errors),
        'errors' => $errors,
    ];
}
```

### Copy Address

```php
public function copy(): self
{
    return self::create([
        'addressable_type' => $this->addressable_type,
        'addressable_id' => $this->addressable_id,
        'type' => $this->type,
        'first_name' => $this->first_name,
        'last_name' => $this->last_name,
        'company' => $this->company,
        'phone' => $this->phone,
        'address_line_1' => $this->address_line_1,
        'address_line_2' => $this->address_line_2,
        'city' => $this->city,
        'state' => $this->state,
        'postal_code' => $this->postal_code,
        'country' => $this->country,
        'tax_id' => $this->tax_id,
        'is_default' => false,
    ]);
}
```

---

## Events

```php
protected static function booted()
{
    static::creating(function (Address $address) {
        // Auto-geocode on create
        if (!$address->has_coordinates) {
            dispatch(fn() => $address->geocode())->afterResponse();
        }
    });

    static::updated(function (Address $address) {
        // Re-geocode if address changed
        if ($address->isDirty(['address_line_1', 'city', 'postal_code', 'country'])) {
            dispatch(fn() => $address->geocode())->afterResponse();
        }
    });
}
```

---

## REST API

### Get Customer Addresses

```http
GET /api/v1/customers/{customer}/addresses
```

**Response**:

```json
{
  "data": [
    {
      "id": 45,
      "type": "shipping",
      "full_name": "John Doe",
      "company": "Acme Corp",
      "full_address": "123 Main St, New York, NY 10001",
      "country_name": "United States",
      "is_default": true,
      "is_verified": true
    }
  ]
}
```

### Create Address

```http
POST /api/v1/customers/{customer}/addresses
```

**Request**:

```json
{
  "type": "shipping",
  "first_name": "John",
  "last_name": "Doe",
  "address_line_1": "123 Main St",
  "city": "New York",
  "state": "NY",
  "postal_code": "10001",
  "country": "US",
  "is_default": true
}
```

### Update Address

```http
PATCH /api/v1/addresses/{id}
```

### Delete Address

```http
DELETE /api/v1/addresses/{id}
```

### Set as Default

```http
POST /api/v1/addresses/{id}/set-default
```

---

## GraphQL API

```graphql
query {
  customer(id: 123) {
    addresses {
      id
      type
      fullName
      fullAddress
      countryName
      isDefault
      isVerified
    }
  }
}

mutation {
  createAddress(input: {
    customerId: 123
    type: "shipping"
    firstName: "John"
    lastName: "Doe"
    addressLine1: "123 Main St"
    city: "New York"
    state: "NY"
    postalCode: "10001"
    country: "US"
    isDefault: true
  }) {
    address {
      id
      formatted
    }
  }
}
```

---

## Practical Examples

### Create Customer Address

```php
use Cartino\Models\Customer;

$customer = Customer::find(123);

$address = $customer->addresses()->create([
    'type' => 'shipping',
    'first_name' => 'John',
    'last_name' => 'Doe',
    'address_line_1' => '123 Main St',
    'city' => 'New York',
    'state' => 'NY',
    'postal_code' => '10001',
    'country' => 'US',
    'is_default' => true,
]);
```

### Get Default Shipping Address

```php
$shippingAddress = $customer->addresses()
    ->shipping()
    ->default()
    ->first();
```

### Copy Shipping to Billing

```php
$shipping = $customer->addresses()->shipping()->default()->first();

if ($shipping) {
    $billing = $shipping->copy();
    $billing->update(['type' => 'billing']);
}
```

---
