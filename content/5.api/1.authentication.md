---
title: Authentication
description: Secure API authentication with tokens, OAuth, and session management.
---

# Authentication

Cartino provides multiple authentication methods to secure your API requests. Choose the method that best fits your use case.

[TOC]

## Authentication Methods

### API Keys (Recommended)

Best for server-to-server communication and backend integrations.

```bash
curl -X GET https://your-store.com/api/products \
  -H "Authorization: Bearer sk_live_abcdef123456" \
  -H "Accept: application/json"
```

**Format**: `Bearer {api_key}`

### OAuth 2.0

For third-party applications requiring user authorization.

```bash
# Authorization Code Flow
GET /oauth/authorize?client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&response_type=code
```

### Session-Based

For same-domain requests from your frontend application.

```bash
# Using CSRF token
curl -X POST https://your-store.com/api/cart/items \
  -H "X-CSRF-TOKEN: abc123..." \
  -H "Cookie: laravel_session=xyz..."
```

---

## API Keys

### Creating API Keys

Generate API keys from the admin dashboard:

1. Navigate to **Settings → API**
2. Click **Generate New Key**
3. Set permissions and scopes
4. Copy the key (shown only once!)

```php
// Programmatically create API key
use App\Models\ApiKey;

$apiKey = ApiKey::create([
    'name' => 'Production API',
    'scopes' => ['products:read', 'orders:write'],
    'expires_at' => now()->addYear(),
]);

// Get the plain key (only available on creation)
$plainKey = $apiKey->plainTextKey; // sk_live_abc123...
```

### Using API Keys

Include the API key in the `Authorization` header:

```bash
Authorization: Bearer sk_live_abc123456
```

**Example Request**:

```bash
curl -X GET https://your-store.com/api/products \
  -H "Authorization: Bearer sk_live_abc123456" \
  -H "Accept: application/json"
```

**Response**:

```json
{
  "data": [
    {
      "id": 1,
      "title": "Cotton T-Shirt",
      "price": 19.99
    }
  ]
}
```

### Key Types

#### Live Keys

- Prefix: `sk_live_`
- Access production data
- Used in production environments

#### Test Keys

- Prefix: `sk_test_`
- Access sandbox data
- Safe for development and testing

### Scopes & Permissions

Limit API key access with granular scopes:

| Scope | Description |
|-------|-------------|
| `products:read` | Read products and variants |
| `products:write` | Create and update products |
| `orders:read` | Read orders and details |
| `orders:write` | Create and update orders |
| `customers:read` | Read customer data |
| `customers:write` | Create and update customers |
| `inventory:read` | Read inventory levels |
| `inventory:write` | Update inventory |
| `admin:all` | Full admin access |

**Example with Scopes**:

```php
$apiKey = ApiKey::create([
    'name' => 'Read-Only Integration',
    'scopes' => [
        'products:read',
        'orders:read',
        'customers:read',
    ],
]);
```

### Best Practices

::alert{type="warning"}
**Never expose API keys in client-side code or public repositories.**
::

- Store keys in environment variables
- Use different keys for different environments
- Rotate keys regularly (every 90 days)
- Delete unused keys immediately
- Use minimum required scopes
- Monitor key usage in admin dashboard

```bash
# .env
CARTINO_API_KEY=sk_live_abc123456
CARTINO_TEST_KEY=sk_test_xyz789012
```

---

## OAuth 2.0

### OAuth Flows

#### Authorization Code Flow

Best for web applications with a backend:

**Step 1: Authorization Request**

```bash
GET /oauth/authorize?
  client_id=CLIENT_ID&
  redirect_uri=https://your-app.com/callback&
  response_type=code&
  scope=products:read orders:read&
  state=random_string
```

**Step 2: User Authorizes**

User logs in and grants permissions.

**Step 3: Exchange Code for Token**

```bash
POST /oauth/token
Content-Type: application/json

{
  "grant_type": "authorization_code",
  "client_id": "CLIENT_ID",
  "client_secret": "CLIENT_SECRET",
  "code": "AUTH_CODE",
  "redirect_uri": "https://your-app.com/callback"
}
```

**Response**:

```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "refresh_token": "def50200...",
  "token_type": "Bearer",
  "expires_in": 3600
}
```

**Step 4: Use Access Token**

```bash
curl -X GET https://your-store.com/api/products \
  -H "Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc..."
```

#### Client Credentials Flow

For server-to-server authentication:

```bash
POST /oauth/token
Content-Type: application/json

{
  "grant_type": "client_credentials",
  "client_id": "CLIENT_ID",
  "client_secret": "CLIENT_SECRET",
  "scope": "products:read"
}
```

#### Refresh Token Flow

Refresh expired access tokens:

```bash
POST /oauth/token
Content-Type: application/json

{
  "grant_type": "refresh_token",
  "refresh_token": "def50200...",
  "client_id": "CLIENT_ID",
  "client_secret": "CLIENT_SECRET"
}
```

### Creating OAuth Apps

Register your application in the admin dashboard:

1. Navigate to **Settings → OAuth Apps**
2. Click **Create New App**
3. Fill in app details:
   - Name
   - Redirect URIs
   - Scopes
4. Save and copy credentials

### OAuth Scopes

Same as API key scopes, but requested by the user during authorization.

---

## Session-Based Authentication

For same-domain frontend applications using Laravel Sanctum.

### Setup CSRF Protection

**Step 1: Get CSRF Cookie**

```bash
GET /sanctum/csrf-cookie
```

**Step 2: Login**

```bash
POST /login
Content-Type: application/json
X-CSRF-TOKEN: {csrf_token}

{
  "email": "user@example.com",
  "password": "password"
}
```

**Step 3: Make Authenticated Requests**

```bash
POST /api/cart/items
Content-Type: application/json
X-CSRF-TOKEN: {csrf_token}
Cookie: laravel_session=...

{
  "variant_id": 1,
  "quantity": 2
}
```

### JavaScript Example

```javascript
// Axios with credentials
axios.defaults.withCredentials = true;

// Get CSRF cookie
await axios.get('/sanctum/csrf-cookie');

// Login
await axios.post('/login', {
  email: 'user@example.com',
  password: 'password'
});

// Make API request
const response = await axios.get('/api/products');
```

---

## Rate Limiting

API requests are rate limited to prevent abuse:

| Tier | Limit | Period |
|------|-------|--------|
| **Free** | 60 requests | 1 minute |
| **Pro** | 300 requests | 1 minute |
| **Enterprise** | 1000 requests | 1 minute |

### Rate Limit Headers

Every response includes rate limit headers:

```
X-RateLimit-Limit: 60
X-RateLimit-Remaining: 45
X-RateLimit-Reset: 1640000000
```

### Handling Rate Limits

When you exceed the rate limit:

**Response: 429 Too Many Requests**

```json
{
  "message": "Too Many Requests",
  "retry_after": 30
}
```

**Best Practice**: Implement exponential backoff:

```javascript
async function fetchWithRetry(url, options, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const response = await fetch(url, options);

      if (response.status === 429) {
        const retryAfter = response.headers.get('Retry-After') || 30;
        await sleep(retryAfter * 1000 * Math.pow(2, i));
        continue;
      }

      return response;
    } catch (error) {
      if (i === maxRetries - 1) throw error;
    }
  }
}
```

---

## Security Best Practices

### HTTPS Only

::alert{type="danger"}
**Always use HTTPS in production.** Never send API keys over unencrypted connections.
::

```bash
# ✅ Good
https://your-store.com/api/products

# ❌ Bad
http://your-store.com/api/products
```

### API Key Storage

**Environment Variables** (Recommended):

```bash
# .env
CARTINO_API_KEY=sk_live_abc123

# In your code
$apiKey = env('CARTINO_API_KEY');
```

**Never** hardcode keys:

```php
// ❌ Don't do this
$apiKey = 'sk_live_abc123';

// ✅ Do this
$apiKey = config('services.cartino.api_key');
```

### IP Whitelisting

Restrict API key usage to specific IP addresses:

```php
$apiKey = ApiKey::create([
    'name' => 'Production API',
    'allowed_ips' => [
        '203.0.113.0/24',
        '198.51.100.42',
    ],
]);
```

### Key Rotation

Rotate API keys regularly:

```php
// Generate new key
$newKey = ApiKey::create(['name' => 'Production API v2']);

// Update your app to use new key
// ...

// Revoke old key after transition period
$oldKey->revoke();
```

---

## Troubleshooting

### 401 Unauthorized

**Cause**: Invalid or missing API key

**Solution**:
- Check the API key is correct
- Ensure `Authorization` header is included
- Verify key hasn't expired or been revoked

```bash
# Check your request
curl -X GET https://your-store.com/api/products \
  -H "Authorization: Bearer YOUR_KEY" \
  -v  # Verbose mode to see headers
```

### 403 Forbidden

**Cause**: Insufficient permissions

**Solution**:
- Check API key scopes
- Verify the key has required permissions
- Request appropriate scopes

### 429 Too Many Requests

**Cause**: Rate limit exceeded

**Solution**:
- Implement exponential backoff
- Reduce request frequency
- Upgrade to higher tier
- Cache responses when possible

---

## Examples

### PHP SDK

```php
use Cartino\SDK\Client;

$client = new Client('sk_live_abc123');

// Fetch products
$products = $client->products()->list([
    'status' => 'active',
    'limit' => 20
]);

foreach ($products as $product) {
    echo $product->title;
}
```

### JavaScript SDK

```javascript
import { Cartino } from '@cartino/sdk';

const client = new Cartino('sk_live_abc123');

// Fetch products
const products = await client.products.list({
  status: 'active',
  limit: 20
});

products.data.forEach(product => {
  console.log(product.title);
});
```

### cURL

```bash
# List products
curl -X GET https://your-store.com/api/products?status=active \
  -H "Authorization: Bearer sk_live_abc123" \
  -H "Accept: application/json"

# Create order
curl -X POST https://your-store.com/api/orders \
  -H "Authorization: Bearer sk_live_abc123" \
  -H "Content-Type: application/json" \
  -d '{
    "customer_id": 1,
    "items": [
      {"variant_id": 1, "quantity": 2}
    ]
  }'
```

---

## Next Steps

::card-group
  :::card
  ---
  icon: i-lucide-network
  to: /api/rest
  ---
  #title
  REST API Reference

  #description
  Explore all available endpoints
  :::
::
::
